<div class="game-form">
  <a class="game-form__back" (click)="goBack()">{{ i18n.t('gameForm.back') }}</a>
  <h1 class="game-form__title">{{ isEdit ? i18n.t('gameForm.editTitle') : i18n.t('gameForm.newTitle') }}</h1>

  <div class="game-form__body">
    <!-- Основна інформація -->
    <div class="game-form__section">
      <h2 class="game-form__section-title">{{ i18n.t('gameForm.general') }}</h2>

      <div class="game-form__row">
        <div class="game-form__field">
          <label class="game-form__label">{{ i18n.t('gameForm.title') }} *</label>
          <input class="game-form__input" type="text" [(ngModel)]="form.title" [placeholder]="i18n.t('gameForm.titlePlaceholder')" />
        </div>
        <div class="game-form__field">
          <label class="game-form__label">{{ i18n.t('gameForm.developer') }}</label>
          <input class="game-form__input" type="text" [(ngModel)]="form.developer" placeholder="Valve, CD Projekt Red..." />
        </div>
      </div>

      <div class="game-form__row">
        <div class="game-form__field">
          <label class="game-form__label">{{ i18n.t('gameForm.coverImage') }} *</label>
          <input class="game-form__input" type="url" [(ngModel)]="form.coverImage" placeholder="https://..." />
        </div>
        <div class="game-form__field">
          <label class="game-form__label">{{ i18n.t('gameForm.backgroundImage') }}</label>
          <input class="game-form__input" type="url" [(ngModel)]="form.backgroundImage" placeholder="https://..." />
        </div>
      </div>

      @if (form.coverImage) {
        <img [src]="form.coverImage" alt="preview" class="game-form__cover-preview" />
      }

      <div class="game-form__row">
        <div class="game-form__field">
          <label class="game-form__label">{{ i18n.t('gameForm.status') }}</label>
          <select class="game-form__select" [(ngModel)]="form.status">
            @for (s of statuses; track s) {
              <option [value]="s">{{ i18n.t('games.status.' + s) }}</option>
            }
          </select>
        </div>
        <div class="game-form__field">
          <label class="game-form__label">{{ i18n.t('gameForm.hoursPlayed') }}</label>
          <input class="game-form__input" type="number" [(ngModel)]="form.hoursPlayed" min="0" step="0.5" />
        </div>
        <div class="game-form__field">
          <label class="game-form__label">{{ i18n.t('gameForm.rating') }} (1–5)</label>
          <input class="game-form__input" type="number" [(ngModel)]="form.rating" min="1" max="5" step="1" />
        </div>
      </div>

      <div class="game-form__row">
        <div class="game-form__field">
          <label class="game-form__label">{{ i18n.t('gameForm.genres') }}</label>
          <input class="game-form__input" type="text" [(ngModel)]="genresStr" [placeholder]="i18n.t('gameForm.genresPlaceholder')" />
        </div>
        <div class="game-form__field">
          <label class="game-form__label">Steam URL</label>
          <input class="game-form__input" type="url" [(ngModel)]="form.steamUrl" placeholder="https://store.steampowered.com/app/..." />
        </div>
      </div>

      <div class="game-form__field">
        <label class="game-form__label">{{ i18n.t('gameForm.review') }}</label>
        <textarea class="game-form__textarea" [(ngModel)]="form.review" [placeholder]="i18n.t('gameForm.reviewPlaceholder')" rows="4"></textarea>
      </div>

      <div class="game-form__checkbox">
        <input type="checkbox" id="pinned" [(ngModel)]="form.pinned" />
        <label for="pinned">{{ i18n.t('gameForm.pinned') }}</label>
      </div>
    </div>

    <!-- Досягнення -->
    <div class="game-form__section">
      <h2 class="game-form__section-title">{{ i18n.t('gameForm.achievements') }}</h2>
      <p class="game-form__hint">{{ i18n.t('gameForm.achievementsHint') }}</p>

      @for (ach of form.achievements; track $index; let i = $index) {
        <div class="game-form__ach-card">
          <div class="game-form__ach-header">
            <span>{{ i18n.t('gameForm.achievement') }} {{ i + 1 }}</span>
            <button class="game-form__remove-btn" (click)="removeAchievement(i)">✕</button>
          </div>
          <div class="game-form__row">
            <div class="game-form__field">
              <label class="game-form__label">{{ i18n.t('gameForm.achTitle') }}</label>
              <input class="game-form__input" type="text" [(ngModel)]="ach.title" [placeholder]="i18n.t('gameForm.achTitlePlaceholder')" />
            </div>
            <div class="game-form__field">
              <label class="game-form__label">{{ i18n.t('gameForm.achDesc') }}</label>
              <input class="game-form__input" type="text" [(ngModel)]="ach.description" [placeholder]="i18n.t('gameForm.achDescPlaceholder')" />
            </div>
          </div>
          <div class="game-form__row game-form__row--sm">
            <div class="game-form__checkbox">
              <input type="checkbox" [id]="'ach-done-' + i" [(ngModel)]="ach.completed" />
              <label [for]="'ach-done-' + i">{{ i18n.t('gameForm.achCompleted') }}</label>
            </div>
            @if (ach.completed) {
              <div class="game-form__field">
                <label class="game-form__label">{{ i18n.t('gameForm.achDate') }}</label>
                <input class="game-form__input game-form__input--sm" type="text" [(ngModel)]="ach.completedAt" placeholder="2024-01-15" />
              </div>
            }
          </div>
        </div>
      }

      <button class="game-form__add-btn" (click)="addAchievement()">+ {{ i18n.t('gameForm.addAchievement') }}</button>
    </div>

    <!-- Footer -->
    <div class="game-form__footer">
      @if (saveMessage) {
        <div class="game-form__message" [class.game-form__message--error]="saveMessage === i18n.t('gameForm.error')">
          {{ saveMessage }}
        </div>
      }
      <div class="game-form__footer-actions">
        @if (isEdit) {
          <button class="game-form__delete-btn" (click)="deleteGame()" [disabled]="deleting">
            {{ deleting ? '...' : i18n.t('gameForm.delete') }}
          </button>
        }
        <button class="game-form__save-btn" (click)="save()" [disabled]="saving">
          {{ saving ? i18n.t('gameForm.saving') : i18n.t('gameForm.save') }}
        </button>
      </div>
    </div>
  </div>
</div>
